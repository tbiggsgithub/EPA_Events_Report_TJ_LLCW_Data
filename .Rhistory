points(tje.no2005$P.lind.by.cut.date.mm,tje.no2005$Corrected_load_tons,col="grey",pch=20,cex=1.5)
mtext(side=2,"Sediment load, tons",line=3)
mtext(side=1,"Precipitation, Lindbergh, mm",line=3)
par(mfrow=c(1,1))
plot(tje.corr.2006.2012.totals$P.by.cut.date.mm,tje.corr.2006.2012.totals$P.lind.by.cut.date.mm,xlab="P, mm, IB",ylab="P, mm, Lind")
abline(0,1)
tje.no2005
par(mfrow=c(2,1),mar=c(2,0,0,0),oma=c(4,5,2,2))
plot(tje.no2005$P.by.cut.date.mm,tje.no2005$Tons_removed_uncorrected,xlab="Precipitation between cleanings, mm",ylab="Tons removed",pch=20,cex=1.5,ylim=c(0,90000))
points(tje.no2005$P.by.cut.date.mm,tje.no2005$Corrected_load_tons,pch=20,cex=1.5,col="grey")
mtext(side=2,"Sediment load, tons",line=3)
plot(tje.no2005$P.lind.by.cut.date.mm,tje.no2005$Tons_removed_uncorrected,xlab="Precipitation between cleanings, mm",ylab="Tons removed",pch=20,cex=1.5,ylim=c(0,90000))
points(tje.no2005$P.lind.by.cut.date.mm,tje.no2005$Corrected_load_tons,col="grey",pch=20,cex=1.5)
mtext(side=2,"Sediment load, tons",line=3)
mtext(side=1,"Precipitation, Lindbergh, mm",line=3)
par(mfrow=c(2,1),mar=c(1,0,0,0),oma=c(4,5,2,2))
plot(P.IB$Date,P.IB$Precip,type="l",xlim=as.Date(c("2004-10-10","2016-12-31")))
abline(v=cut.dates,lty=2,lwd=2,col="grey")
plot(P.lind$Date,P.lind$PRCP/10,type="l",xlim=as.Date(c("2004-10-10","2016-12-31")))
abline(v=cut.dates,lty=2,lwd=2,col="grey")
par(mfrow=c(2,1),mar=c(1,0,0,0),oma=c(4,5,2,2))
plot(P.IB$Date,P.IB$Precip,type="l",xlim=as.Date(c("2004-10-10","2016-12-31")),xaxt="n")
axis(side=1,labels=FALSE)
abline(v=cut.dates,lty=2,lwd=2,col="grey")
plot(P.lind$Date,P.lind$PRCP/10,type="l",xlim=as.Date(c("2004-10-10","2016-12-31")))
abline(v=cut.dates,lty=2,lwd=2,col="grey")
axis(side=1,labels=TRUE)
par(mfrow=c(2,1),mar=c(1,0,0,0),oma=c(4,5,2,2))
plot(P.IB$Date,P.IB$Precip,type="l",xlim=as.Date(c("2004-10-10","2016-12-31")),xaxt="n")
axis(side=1,labels=FALSE)
abline(v=cut.dates,lty=2,lwd=2,col="grey")
plot(P.lind$Date,P.lind$PRCP/10,type="l",xlim=as.Date(c("2004-10-10","2016-12-31")))
abline(v=cut.dates,lty=2,lwd=2,col="grey")
#barplot(P.IB$Precip,P.IB$Date,space=c(0,1),width=0.5,border="black")
par(mfrow=c(2,1),mar=c(3,0,0,0),oma=c(4,5,2,2))
plot(P.IB$Date,P.IB$Precip,type="l",xlim=as.Date(c("2004-10-10","2016-12-31")),xaxt="n")
axis(side=1,labels=FALSE)
abline(v=cut.dates,lty=2,lwd=2,col="grey")
plot(P.lind$Date,P.lind$PRCP/10,type="l",xlim=as.Date(c("2004-10-10","2016-12-31")))
abline(v=cut.dates,lty=2,lwd=2,col="grey")
#barplot(P.IB$Precip,P.IB$Date,space=c(0,1),width=0.5,border="black")
par(mfrow=c(2,1),mar=c(1,0,0,0),oma=c(4,5,2,2))
plot(P.IB$Date,P.IB$Precip,type="l",xlim=as.Date(c("2004-10-10","2016-12-31")))
abline(v=cut.dates,lty=2,lwd=2,col="grey")
plot(P.lind$Date,P.lind$PRCP/10,type="l",xlim=as.Date(c("2004-10-10","2016-12-31")))
abline(v=cut.dates,lty=2,lwd=2,col="grey")
par(mfrow=c(2,1),mar=c(1,0,0,0),oma=c(4,5,2,2))
plot(P.IB$Date,P.IB$Precip,type="l",xlim=as.Date(c("2004-10-10","2016-12-31")))
abline(v=cut.dates,lty=2,lwd=2,col="grey")
mtext(side=2,"Daily Precipitation, mm")
plot(P.lind$Date,P.lind$PRCP/10,type="l",xlim=as.Date(c("2004-10-10","2016-12-31")))
abline(v=cut.dates,lty=2,lwd=2,col="grey")
par(mfrow=c(2,1),mar=c(1,0,0,0),oma=c(4,5,2,2))
plot(P.IB$Date,P.IB$Precip,type="l",xlim=as.Date(c("2004-10-10","2016-12-31")))
abline(v=cut.dates,lty=2,lwd=2,col="grey")
mtext(side=2,"Daily Precipitation, mm",line=3)
plot(P.lind$Date,P.lind$PRCP/10,type="l",xlim=as.Date(c("2004-10-10","2016-12-31")))
abline(v=cut.dates,lty=2,lwd=2,col="grey")
indir.IB.ream = "G:/mydocuments/SDSU/research/tijuana_watershed/precipitation/NOAA_imperial_beach_ream_field_NAS/"
fname.IB.ream = "imperial_beach_ream_field_daily_1945_2012.csv"
P.IBream = read.csv(paste0(indir.IB.ream,fname.IB.ream))
head(P.IBream)
P.IBream$Date = as.Date(strptime(P.IBream$DATE,format="%Y%m%d"))
format.precip <- function(indir,fname){
x = read.csv(paste0(indir,fname))
x$Date = as.Date(strptime(x$DATE,format="%Y%m%d"))
x$Date = as.Date(strptime(x$DATE,format="%Y%m%d"))
x$month = as.numeric(format(x$Date,"%m"))
x$year = as.numeric(format(x$Date,"%Y"))
x$wy = x$year
x$wy[x$month>=10] = x$wy[x$month>=10]+1
return(x)
}
indir.Lind = "G:/mydocuments/SDSU/research/tijuana_watershed/precipitation/"
fname.Lind = "125207_lindbergh_field.csv"
P.lind = format.precip(indir.Lind,fname.Lind)
indir.Lind = "G:/mydocuments/SDSU/research/tijuana_watershed/precipitation/NOAA_lindbergh_field/"
fname.Lind = "125207_lindbergh_field.csv"
P.lind = format.precip(indir.Lind,fname.Lind)
head(Plind)
head(P.lind)
P.IBream = format.precip(indir.IB.ream,fname.IB.ream)
x=P.IBream
x.ann.P.wy = aggregate(x$PRCP.0.1MM,by=list(x$wy),FUN="sum")
x.ann.count.wy = aggregate(x$PRCP.0.1MM,by=list(x$wy),FUN="length")
x.ann.P.wy
x.ann.count.wy
xout = data.frame(Year=x.ann.P.wy$Group.1,P.mm=x.ann.P.wy$x/10,P.count=x.ann.count.wy$x)
xout
summarize.precip <- function(x){
# Calculate total precip
x.ann.P.wy = aggregate(x$PRCP.0.1MM,by=list(x$wy),FUN="sum")
x.ann.count.wy = aggregate(x$PRCP.0.1MM,by=list(x$wy),FUN="length")
xout = data.frame(Year=x.ann.P.wy$Group.1,P.mm=x.ann.P.wy$x/10,P.count=x.ann.count.wy$x)
return(xout)
}
P.IBream.sum = summarize.precip(x=P.IBream)
P.IBream.sum
P.lind.sum = summarize.precip(x=P.lind)
P.lind
head(P.lind)
P.lind = format.precip(indir.Lind,fname.Lind)
head(P.lind)
P.lind.sum = summarize.precip(x=P.lind)
P.lind.sum
indir.Chula.Vista = "G:/mydocuments/SDSU/research/tijuana_watershed/precipitation/NOAA_chula_vista/"
fname.Chula.Vista = "chula_vista_1918_2012.csv"
P.IBream = format.precip(indir.Chula.Vista,fname.Chula.Vista)
indir.Chula.Vista = "G:/mydocuments/SDSU/research/tijuana_watershed/precipitation/NOAA_chula_vista/"
fname.Chula.Vista = "chula_vista_1918_2012.csv"
P.Chula.Vista = format.precip(indir.Chula.Vista,fname.Chula.Vista)
P.Chula.Vista.sum = summarize.precip(x=P.Chula.Vista)
P.Chula.Vista.sum
indir.Jamul = "G:/mydocuments/SDSU/research/tijuana_watershed/precipitation/NOAA_chula_vista/"
fname.Jamul = "chula_vista_1918_2012.csv"
indir.Jamul = "G:/mydocuments/SDSU/research/tijuana_watershed/precipitation/NOAA_jamul/"
fname.Jamul = "san_diego_jamul_daily_precip_1998_2012.csv"
P.Jamul = format.precip(indir.Jamul,fname.Jamul)
P.Jamul.sum = summarize.precip(x=P.Jamul)
P.Jamul.sum
indir.Jamul = "G:/mydocuments/SDSU/research/tijuana_watershed/precipitation/NOAA_imperial_beach_33/"
fname.Jamul = "US1CASD0003_IB33_2008_2017.csv"
P.Jamul = format.precip(indir.Jamul,fname.Jamul)
indir.IB33 = "G:/mydocuments/SDSU/research/tijuana_watershed/precipitation/NOAA_imperial_beach_33/"
fname.IB33 = "US1CASD0003_IB33_2008_2017.csv"
P.IB33 = format.precip(indir.IB33,fname.IB33)
P.IB33.sum = summarize.precip(x=P.IB33)
P.IB33
indir.IB33 = "G:/mydocuments/SDSU/research/tijuana_watershed/precipitation/NOAA_imperial_beach_33/"
fname.IB33 = "US1CASD0003_IB33_2008_2017.csv"
P.IB33 = format.precip(indir.IB33,fname.IB33)
head(P.IB33)
P.IB33.sum = summarize.precip(x=P.IB33)
P.IB33.sum
head(P.IB33)
P.IB33.sum = summarize.precip(x=P.IB33)
P.IB33.sum
format.precip <- function(indir,fname){
x = read.csv(paste0(indir,fname))
x$Date = as.Date(strptime(x$DATE,format="%Y%m%d"))
x$Date = as.Date(strptime(x$DATE,format="%Y%m%d"))
x$month = as.numeric(format(x$Date,"%m"))
x$year = as.numeric(format(x$Date,"%Y"))
x$wy = x$year
x$wy[x$month>=10] = x$wy[x$month>=10]+1
xout = x[!is.na(x$PRCP.0.1MM),]
return(xout)
}
summarize.precip <- function(x){
# Calculate total precip
x.ann.P.wy = aggregate(x$PRCP.0.1MM,by=list(x$wy),FUN="sum")
x.ann.count.wy = aggregate(x$PRCP.0.1MM,by=list(x$wy),FUN="length")
xout = data.frame(Year=x.ann.P.wy$Group.1,P.mm=x.ann.P.wy$x/10,P.count=x.ann.count.wy$x)
return(xout)
}
indir.Lind = "G:/mydocuments/SDSU/research/tijuana_watershed/precipitation/NOAA_lindbergh_field/"
fname.Lind = "125207_lindbergh_field.csv"
P.lind = format.precip(indir.Lind,fname.Lind)
P.lind.sum = summarize.precip(x=P.lind)
P.lind.sum
indir.IB.ream = "G:/mydocuments/SDSU/research/tijuana_watershed/precipitation/NOAA_imperial_beach_ream_field_NAS/"
fname.IB.ream = "imperial_beach_ream_field_daily_1945_2012.csv"
P.IBream = format.precip(indir.IB.ream,fname.IB.ream)
P.IBream.sum = summarize.precip(x=P.IBream)
P.IBream.sum
indir.Chula.Vista = "G:/mydocuments/SDSU/research/tijuana_watershed/precipitation/NOAA_chula_vista/"
fname.Chula.Vista = "chula_vista_1918_2012.csv"
P.Chula.Vista = format.precip(indir.Chula.Vista,fname.Chula.Vista)
P.Chula.Vista.sum = summarize.precip(x=P.Chula.Vista)
P.Chula.Vista.sum
indir.Jamul = "G:/mydocuments/SDSU/research/tijuana_watershed/precipitation/NOAA_jamul/"
fname.Jamul = "san_diego_jamul_daily_precip_1998_2012.csv"
P.Jamul = format.precip(indir.Jamul,fname.Jamul)
P.Jamul.sum = summarize.precip(x=P.Jamul)
P.Jamul.sum
indir.IB33 = "G:/mydocuments/SDSU/research/tijuana_watershed/precipitation/NOAA_imperial_beach_33/"
fname.IB33 = "US1CASD0003_IB33_2008_2017.csv"
P.IB33 = format.precip(indir.IB33,fname.IB33)
P.IB33.sum = summarize.precip(x=P.IB33)
P.IB33.sum
head(P.IB33)
unique(P.IB33$wy)
indir.IB33 = "G:/mydocuments/SDSU/research/tijuana_watershed/precipitation/NOAA_imperial_beach_33/"
fname.IB33 = "US1CASD0003_IB33_2008_2017.csv"
P.IB33 = format.precip(indir.IB33,fname.IB33)
P.IB33.sum = summarize.precip(x=P.IB33)
P.IB33.sum
IB.annual.precip.mm.wy
P.Jamul.sum
IB.annual.count.by.year
IB.annual.count.by.wy = aggregate(as.numeric(as.character(P.IB$Precip)), by= list(as.character(P.IB$wy)), FUN=length) #sum by water year
IB.annual.count.by.wy
P.lind.sum
P.IB.sum = data.frame(Year=IB.annual.precip.mm.wy$Group.1,P.mm=IB.annual.precip.mm.wy$x/10,P.count=IB.annual.count.by.wy$x)
P.IB.sum
yrange = range(range(P.IB.sum$Year),range(P.IB33.sum$Year),range(P.Jamul.sum$Year),range(P.Chula.Vista.sum$Year),range(P.lind.sum$Year))
summarize.precip <- function(x){
# Calculate total precip
x.ann.P.wy = aggregate(x$PRCP.0.1MM,by=list(x$wy),FUN="sum")
x.ann.count.wy = aggregate(x$PRCP.0.1MM,by=list(x$wy),FUN="length")
xout = data.frame(Year=as.numeric(as.character(x.ann.P.wy$Group.1)),P.mm=x.ann.P.wy$x/10,P.count=x.ann.count.wy$x)
return(xout)
}
P.IB.sum = data.frame(Year=as.numeric(as.character(IB.annual.precip.mm.wy$Group.1)),P.mm=IB.annual.precip.mm.wy$x/10,P.count=IB.annual.count.by.wy$x)
indir.Lind = "G:/mydocuments/SDSU/research/tijuana_watershed/precipitation/NOAA_lindbergh_field/"
fname.Lind = "125207_lindbergh_field.csv"
P.lind = format.precip(indir.Lind,fname.Lind)
P.lind.sum = summarize.precip(x=P.lind)
indir.IB.ream = "G:/mydocuments/SDSU/research/tijuana_watershed/precipitation/NOAA_imperial_beach_ream_field_NAS/"
fname.IB.ream = "imperial_beach_ream_field_daily_1945_2012.csv"
P.IBream = format.precip(indir.IB.ream,fname.IB.ream)
P.IBream.sum = summarize.precip(x=P.IBream)
indir.Chula.Vista = "G:/mydocuments/SDSU/research/tijuana_watershed/precipitation/NOAA_chula_vista/"
fname.Chula.Vista = "chula_vista_1918_2012.csv"
P.Chula.Vista = format.precip(indir.Chula.Vista,fname.Chula.Vista)
P.Chula.Vista.sum = summarize.precip(x=P.Chula.Vista)
indir.Jamul = "G:/mydocuments/SDSU/research/tijuana_watershed/precipitation/NOAA_jamul/"
fname.Jamul = "san_diego_jamul_daily_precip_1998_2012.csv"
P.Jamul = format.precip(indir.Jamul,fname.Jamul)
P.Jamul.sum = summarize.precip(x=P.Jamul)
indir.IB33 = "G:/mydocuments/SDSU/research/tijuana_watershed/precipitation/NOAA_imperial_beach_33/"
fname.IB33 = "US1CASD0003_IB33_2008_2017.csv"
P.IB33 = format.precip(indir.IB33,fname.IB33)
P.IB33.sum = summarize.precip(x=P.IB33)
yrange = range(range(P.IB.sum$Year),range(P.IB33.sum$Year),range(P.Jamul.sum$Year),range(P.Chula.Vista.sum$Year),range(P.lind.sum$Year))
IB.annual.precip.mm.wy$lind.P.wy.IB.wyrs = lind.annual.precip.mm.wy[match(IB.annual.precip.mm.wy$Group.1,lind.annual.precip.mm.wy$Group.1),"x"]
yrange
seq(yrange)
seq(yrange[1],yrange[2])
P.IB.sum
P.lind.sum
P.IBream.sum
P.Chula.Vista.sum
P.Jamul.sum
P.IB33.sum
P.all.sum = data.frame(Year=seq(1980,yrange[2]))
P.all.sum
P.all.sum = data.frame(Year=seq(1990,yrange[2]))
P.all.sum
st.list = c("P.IB","P.lind","P.IBream","P.Jamul","P.IB33","P.Chula.Vista")
i=1
eval(df.tmp  = paste0(stlist[i],".sum"))
df.tmp  = paste0(stlist[i],".sum")
paste0(st.list[i],".sum")
df.tmp  = paste0(st.list[i],".sum")
eval("df.tmp  = ", paste0(st.list[i],".sum"))
eval(parse(text=paste0("df.tmp  = ", st.list[i],".sum")))
df.tmp
match.tmp = match(df.tmp$Year,P.all.sum$Year)
match.tmp
P.all.sum[match.tmp,i+1] = df.tmp$P.count
head(P.all.sum)
P.all.sum
P.all.sum = data.frame(Year=seq(1990,yrange[2]))
st.list = c("P.IB","P.lind","P.IBream","P.Jamul","P.IB33","P.Chula.Vista")
N.stations = length(st.list)
for (i in 1:N.stations){
eval(parse(text=paste0("df.tmp  = ", st.list[i],".sum")))
match.tmp = match(df.tmp$Year,P.all.sum$Year)
P.all.sum[match.tmp,i+1] = df.tmp$P.count
}
P.all.sum = data.frame(Year=seq(yrange[1],yrange[2]))
st.list = c("P.IB","P.lind","P.IBream","P.Jamul","P.IB33","P.Chula.Vista")
N.stations = length(st.list)
for (i in 1:N.stations){
eval(parse(text=paste0("df.tmp  = ", st.list[i],".sum")))
match.tmp = match(df.tmp$Year,P.all.sum$Year)
P.all.sum[match.tmp,i+1] = df.tmp$P.count
}
P.all.sum
names(P.all.sum[,2:(1+N.stations)]) = st.list
P.all.sum
P.all.sum.1990.2017 = P.all.sum[P.all.sum$Year %in% seq(1990,2017),]
P.all.sum.1990.2017
for (i in 1:N.stations){
eval(parse(text=paste0("df.tmp  = ", st.list[i],".sum")))
match.tmp = match(df.tmp$Year,P.all.sum$Year)
P.all.sum[match.tmp,i+1] = df.tmp$P.count/365
}
P.all.sum
names(P.all.sum[,2:(1+N.stations)]) = st.list
P.all.sum.1990.2017 = P.all.sum[P.all.sum$Year %in% seq(1990,2017),]
P.all.sum.1990.2017
for (i in 1:N.stations){
eval(parse(text=paste0("df.tmp  = ", st.list[i],".sum")))
match.tmp = match(df.tmp$Year,P.all.sum$Year)
P.all.sum[match.tmp,i+1] = df.tmp$P.count
}
names(P.all.sum[,2:(1+N.stations)]) = st.list
P.all.sum.1990.2017 = P.all.sum[P.all.sum$Year %in% seq(1990,2017),]
P.all.sum.1990.2017
names(P.all.sum[,2:(1+N.stations)]) = st.list
P.all.sum.1990.2017 = P.all.sum[P.all.sum$Year %in% seq(1990,2017),]
P.all.sum.1990.2017
st.list
names(P.all.sum[,2:(1+N.stations)])
names(P.all.sum[,2:(1+N.stations)]) = st.list
names(P.all.sum[,2:(1+N.stations)])
names(P.all.sum[,2:(1+N.stations)])
st.list
class(st.list)
names(P.all.sum) = c("Year",st.list)
P.all.sum
P.all.sum.1990.2017 = P.all.sum[P.all.sum$Year %in% seq(1990,2017),]
P.all.sum.1990.2017
P.invent.t = t(P.all.sum.1990.2017)
P.invent.t
P.invent.t = t(P.all.sum.1990.2017[,2:(N.stations+1)])
P.invent.t
colnames(Pinvent.t) = P.all.sum.1990.2017$Year
P.invent.t = t(P.all.sum.1990.2017[,2:(N.stations+1)])
colnames(Pinvent.t) = P.all.sum.1990.2017$Year
Pinvent.t = t(P.all.sum.1990.2017[,2:(N.stations+1)])
colnames(Pinvent.t) = P.all.sum.1990.2017$Year
Pinvent.t
for (i in 1:N.stations){
eval(parse(text=paste0("df.tmp  = ", st.list[i],".sum")))
match.tmp = match(df.tmp$Year,P.all.sum$Year)
P.all.sum[match.tmp,i+1] = df.tmp$P.count/365
}
names(P.all.sum) = c("Year",st.list)
P.all.sum.1990.2017 = P.all.sum[P.all.sum$Year %in% seq(1990,2017),]
Pinvent.t = t(P.all.sum.1990.2017[,2:(N.stations+1)])
Pinvent.t[is.na(Pinvent.t)] = 0
Pinvent.t[Pinvent.t>1]=1
colnames(Pinvent.t) = P.all.sum.1990.2017$Year
grid = expand.grid(X=as.numeric(colnames(Pinvent.t)),Y=seq(1:N.stations))
grid$Z = as.vector(t(Pinvent.t))
Pinvent.t
library(latticeExtra)
install.packages("latticeExtra")
library(latticeExtra)
col.l <- colorRampPalette(c('red', 'orange', 'yellow', 'green', 'cyan', 'blue'))
levelplot(Z ~ X*Y, data = grid, xlab="",ylab="",scales=list(y=list(at=seq(1:length(stations.wdata)),
labels=stationlist),x=list(at=colnames(Pinvent.t),labels=colnames(Pinvent.t),rot=90)),
#colorkey=list(at=seq(0, 1, 0.2),
#labels=list(at=c(0, 0.3, 0.6, 0.9),
#            labels=c("none", "a bit", "a bit more", "a lot"))),
col.regions=col.l) +
layer(panel.text(X, Y, round(Z, 2),cex=0.7), data = grid)
levelplot(Z ~ X*Y, data = grid, xlab="",ylab="",scales=list(y=list(at=seq(1:N.stations),
labels=stationlist),x=list(at=colnames(Pinvent.t),labels=colnames(Pinvent.t),rot=90)),
#colorkey=list(at=seq(0, 1, 0.2),
#labels=list(at=c(0, 0.3, 0.6, 0.9),
#            labels=c("none", "a bit", "a bit more", "a lot"))),
col.regions=col.l) +
layer(panel.text(X, Y, round(Z, 2),cex=0.7), data = grid)
levelplot(Z ~ X*Y, data = grid, xlab="",ylab="",scales=list(y=list(at=seq(1:N.stations),
labels=st.list),x=list(at=colnames(Pinvent.t),labels=colnames(Pinvent.t),rot=90)),
#colorkey=list(at=seq(0, 1, 0.2),
#labels=list(at=c(0, 0.3, 0.6, 0.9),
#            labels=c("none", "a bit", "a bit more", "a lot"))),
col.regions=col.l) +
layer(panel.text(X, Y, round(Z, 2),cex=0.7), data = grid)
P.all.sum.1990.2017 = P.all.sum[P.all.sum$Year %in% seq(2005,2017),]
Pinvent.t = t(P.all.sum.1990.2017[,2:(N.stations+1)])
Pinvent.t[is.na(Pinvent.t)] = 0
Pinvent.t[Pinvent.t>1]=1
colnames(Pinvent.t) = P.all.sum.1990.2017$Year
grid = expand.grid(X=as.numeric(colnames(Pinvent.t)),Y=seq(1:N.stations))
grid$Z = as.vector(t(Pinvent.t))
library(latticeExtra)
col.l <- colorRampPalette(c('red', 'orange', 'yellow', 'green', 'cyan', 'blue'))
levelplot(Z ~ X*Y, data = grid, xlab="",ylab="",scales=list(y=list(at=seq(1:N.stations),
labels=st.list),x=list(at=colnames(Pinvent.t),labels=colnames(Pinvent.t),rot=90)),
#colorkey=list(at=seq(0, 1, 0.2),
#labels=list(at=c(0, 0.3, 0.6, 0.9),
#            labels=c("none", "a bit", "a bit more", "a lot"))),
col.regions=col.l) +
layer(panel.text(X, Y, round(Z, 2),cex=0.7), data = grid)
P.all.sum.1990.2017 = P.all.sum[P.all.sum$Year %in% seq(2005,2012),]
Pinvent.t = t(P.all.sum.1990.2017[,2:(N.stations+1)])
Pinvent.t[is.na(Pinvent.t)] = 0
Pinvent.t[Pinvent.t>1]=1
colnames(Pinvent.t) = P.all.sum.1990.2017$Year
grid = expand.grid(X=as.numeric(colnames(Pinvent.t)),Y=seq(1:N.stations))
grid$Z = as.vector(t(Pinvent.t))
library(latticeExtra)
col.l <- colorRampPalette(c('red', 'orange', 'yellow', 'green', 'cyan', 'blue'))
levelplot(Z ~ X*Y, data = grid, xlab="",ylab="",scales=list(y=list(at=seq(1:N.stations),
labels=st.list),x=list(at=colnames(Pinvent.t),labels=colnames(Pinvent.t),rot=90)),
#colorkey=list(at=seq(0, 1, 0.2),
#labels=list(at=c(0, 0.3, 0.6, 0.9),
#            labels=c("none", "a bit", "a bit more", "a lot"))),
col.regions=col.l) +
layer(panel.text(X, Y, round(Z, 2),cex=0.7), data = grid)
indir.SDBF = "G:/mydocuments/SDSU/research/tijuana_watershed/precipitation/NOAA_san_diego_brown_field/"
fname.SDBF = "san_diego_brown_field_1998_2017.csv"
P.SDBF = format.precip(indir.SDBF,fname.SDBF)
P.SDBF.sum = summarize.precip(x=P.SDBF)
P.SDBF.sum
st.list = c("P.IB","P.lind","P.IBream","P.Jamul","P.IB33","P.Chula.Vista","P.SDBF")
N.stations = length(st.list)
for (i in 1:N.stations){
eval(parse(text=paste0("df.tmp  = ", st.list[i],".sum")))
match.tmp = match(df.tmp$Year,P.all.sum$Year)
P.all.sum[match.tmp,i+1] = df.tmp$P.count/365
}
names(P.all.sum) = c("Year",st.list)
P.all.sum.1990.2017 = P.all.sum[P.all.sum$Year %in% seq(2005,2012),]
Pinvent.t = t(P.all.sum.1990.2017[,2:(N.stations+1)])
Pinvent.t[is.na(Pinvent.t)] = 0
Pinvent.t[Pinvent.t>1]=1
colnames(Pinvent.t) = P.all.sum.1990.2017$Year
grid = expand.grid(X=as.numeric(colnames(Pinvent.t)),Y=seq(1:N.stations))
grid$Z = as.vector(t(Pinvent.t))
library(latticeExtra)
col.l <- colorRampPalette(c('red', 'orange', 'yellow', 'green', 'cyan', 'blue'))
levelplot(Z ~ X*Y, data = grid, xlab="",ylab="",scales=list(y=list(at=seq(1:N.stations),
labels=st.list),x=list(at=colnames(Pinvent.t),labels=colnames(Pinvent.t),rot=90)),
#colorkey=list(at=seq(0, 1, 0.2),
#labels=list(at=c(0, 0.3, 0.6, 0.9),
#            labels=c("none", "a bit", "a bit more", "a lot"))),
col.regions=col.l) +
layer(panel.text(X, Y, round(Z, 2),cex=0.7), data = grid)
IB.annual.precip.mm.wy$lind.P.wy.IB.wyrs = lind.annual.precip.mm.wy[match(IB.annual.precip.mm.wy$Group.1,lind.annual.precip.mm.wy$Group.1),"x"]
P.all.count = data.frame(Year=seq(yrange[1],yrange[2]))
st.list = c("P.IB","P.lind","P.IBream","P.Jamul","P.IB33","P.Chula.Vista","P.SDBF")
N.stations = length(st.list)
for (i in 1:N.stations){
eval(parse(text=paste0("df.tmp  = ", st.list[i],".sum")))
match.tmp = match(df.tmp$Year,P.all.count$Year)
P.all.count[match.tmp,i+1] = df.tmp$P.count/365
}
names(P.all.count) = c("Year",st.list)
P.all.count.1990.2017 = P.all.count[P.all.count$Year %in% seq(2005,2012),]
Pinvent.t = t(P.all.count.1990.2017[,2:(N.stations+1)])
Pinvent.t[is.na(Pinvent.t)] = 0
Pinvent.t[Pinvent.t>1]=1
colnames(Pinvent.t) = P.all.count.1990.2017$Year
grid = expand.grid(X=as.numeric(colnames(Pinvent.t)),Y=seq(1:N.stations))
grid$Z = as.vector(t(Pinvent.t))
library(latticeExtra)
col.l <- colorRampPalette(c('red', 'orange', 'yellow', 'green', 'cyan', 'blue'))
levelplot(Z ~ X*Y, data = grid, xlab="",ylab="",scales=list(y=list(at=seq(1:N.stations),
labels=st.list),x=list(at=colnames(Pinvent.t),labels=colnames(Pinvent.t),rot=90)),
#colorkey=list(at=seq(0, 1, 0.2),
#labels=list(at=c(0, 0.3, 0.6, 0.9),
#            labels=c("none", "a bit", "a bit more", "a lot"))),
col.regions=col.l) +
layer(panel.text(X, Y, round(Z, 2),cex=0.7), data = grid)
IB.annual.precip.mm.wy$lind.P.wy.IB.wyrs = lind.annual.precip.mm.wy[match(IB.annual.precip.mm.wy$Group.1,lind.annual.precip.mm.wy$Group.1),"x"]
IB.noNA = IB.annual.precip.mm.wy[!is.na(IB.annual.precip.mm.wy$lind.P.wy.IB.wyrs),]
names(df.tmp)
P.all.sum = data.frame(Year=seq(yrange[1],yrange[2]))
for (i in 1:N.stations){
eval(parse(text=paste0("df.tmp  = ", st.list[i],".sum")))
match.tmp = match(df.tmp$Year,P.all.sum$Year)
P.all.sum[match.tmp,i+1] = df.tmp$P.mm
}
P.all.sum
names(P.all.sum) = c("Year",st.list)
P.all.sum
plot(P.all.sum$Plind,P.all.sum$P.SDBF)
P.all.sum$Plind
plot(P.all.sum$P.lind,P.all.sum$P.SDBF)
abline(0,1)
dev.new()
plot(P.all.sum$P.lind,P.all.sum$P.SDBF,xlab="P.Lind, mm",ylab="P.SDBF or P.IB",pch=20)
points(P.all.sum$P.lind,P.all.sum$P.IB*10,col="red",pch=20)
P.all.sub = P.all.sum[P.all.sum$Year %in% seq(1990,2016),]
plot(P.all.sub$P.lind,P.all.sub$P.SDBF,xlab="P.Lind, mm",ylab="P.SDBF or P.IB",pch=20)
points(P.all.sub$P.lind,P.all.sub$P.IB*10,col="red",pch=20)
plot(P.all.sub$P.lind,P.all.sub$P.SDBF,xlab="P.Lind, mm",ylab="P.SDBF or P.IB",pch=20,xlim=c(0,600),ylim=c(0,600))
points(P.all.sub$P.lind,P.all.sub$P.IB*10,col="red",pch=20)
abline(0,1)
P.all.sub
P.all.sub = P.all.sum[P.all.sum$Year %in% seq(2006,2012),]
plot(P.all.sub$P.lind,P.all.sub$P.SDBF,xlab="P.Lind, mm",ylab="P.SDBF or P.IB",pch=20,xlim=c(0,600),ylim=c(0,600))
points(P.all.sub$P.lind,P.all.sub$P.IB*10,col="red",pch=20)
abline(0,1)
dev.new()
plot(P.all.sub$P.lind,P.all.sub$P.SDBF,xlab="P.Lind, mm",ylab="P.SDBF or P.IB",pch=20,xlim=c(0,600),ylim=c(0,600))
points(P.all.sub$P.lind,P.all.sub$P.IB*10,col="red",pch=20)
abline(0,1)
P.SDBF$cut.labels = cut(P.SDBF$Date, cut.dates, labels=tje.corr.2006.2012.totals$Removal_WY_Date[2:length(tje.corr.2006.2012.totals$Removal_WY_Date)])
names(P.SDBF)
P.lind$cut.labels = cut(P.lind$Date, cut.dates, labels=tje.corr.2006.2012.totals$Removal_WY_Date[2:length(tje.corr.2006.2012.totals$Removal_WY_Date)])
P.lind.by.cut.date = aggregate(P.lind$PRCP.0.1MM,by=list(P.lind$cut.labels),FUN="sum")
tje.corr.2006.2012.totals$P.lind.by.cut.date.mm = c(NA,P.lind.by.cut.date$x/10)
tje.corr.2006.2012.totals
P.SDBF$cut.labels = cut(P.SDBF$Date, cut.dates, labels=tje.corr.2006.2012.totals$Removal_WY_Date[2:length(tje.corr.2006.2012.totals$Removal_WY_Date)])
P.SDBF.by.cut.date = aggregate(P.SDBF$PRCP.0.1MM,by=list(P.lind$cut.labels),FUN="sum")
P.SDBF.by.cut.date = aggregate(P.SDBF$PRCP.0.1MM,by=list(P.SDBF$cut.labels),FUN="sum")
tje.corr.2006.2012.totals$P.SDBF.by.cut.date.mm = c(NA,P.SDBF.by.cut.date$x/10)
tje.corr.2006.2012.totals
par(mfrow=c(3,1),mar=c(2,0,0,0),oma=c(4,5,2,2))
plot(tje.corr.2006.2012.totals$P.by.cut.date.mm,tje.corr.2006.2012.totals$Tons_removed_uncorrected,xlab="Precipitation between cleanings, mm",ylab="Tons removed",pch=20,cex=1.5,ylim=c(0,90000))
points(tje.corr.2006.2012.totals$P.by.cut.date.mm,tje.corr.2006.2012.totals$Corrected_load_tons,pch=20,cex=1.5,col="grey")
plot(tje.corr.2006.2012.totals$P.lind.by.cut.date.mm,tje.corr.2006.2012.totals$Tons_removed_uncorrected,xlab="Precipitation between cleanings, mm",ylab="Tons removed",pch=20,cex=1.5,ylim=c(0,90000))
points(tje.corr.2006.2012.totals$P.lind.by.cut.date.mm,tje.corr.2006.2012.totals$Corrected_load_tons,pch=20,cex=1.5,col="grey")
plot(tje.corr.2006.2012.totals$P.SDBF.by.cut.date.mm,tje.corr.2006.2012.totals$Tons_removed_uncorrected,xlab="Precipitation between cleanings, mm",ylab="Tons removed",pch=20,cex=1.5,ylim=c(0,90000))
points(tje.corr.2006.2012.totals$P.SDBF.by.cut.date.mm,tje.corr.2006.2012.totals$Corrected_load_tons,pch=20,cex=1.5,col="grey")
tje.corr.2006.2012.totals
dev.new()
par(mfrow=c(3,1),mar=c(2,0,0,0),oma=c(4,5,2,2))
plot(tje.corr.2006.2012.totals$P.by.cut.date.mm,tje.corr.2006.2012.totals$Tons_removed_uncorrected,xlab="Precipitation between cleanings, mm",ylab="Tons removed",pch=20,cex=1.5,ylim=c(0,90000))
points(tje.corr.2006.2012.totals$P.by.cut.date.mm,tje.corr.2006.2012.totals$Corrected_load_tons,pch=20,cex=1.5,col="grey")
plot(tje.corr.2006.2012.totals$P.lind.by.cut.date.mm,tje.corr.2006.2012.totals$Tons_removed_uncorrected,xlab="Precipitation between cleanings, mm",ylab="Tons removed",pch=20,cex=1.5,ylim=c(0,90000))
points(tje.corr.2006.2012.totals$P.lind.by.cut.date.mm,tje.corr.2006.2012.totals$Corrected_load_tons,pch=20,cex=1.5,col="grey")
plot(tje.corr.2006.2012.totals$P.SDBF.by.cut.date.mm,tje.corr.2006.2012.totals$Tons_removed_uncorrected,xlab="Precipitation between cleanings, mm",ylab="Tons removed",pch=20,cex=1.5,ylim=c(0,90000))
points(tje.corr.2006.2012.totals$P.SDBF.by.cut.date.mm,tje.corr.2006.2012.totals$Corrected_load_tons,pch=20,cex=1.5,col="grey")
dev.new()
par(mfrow=c(3,1),mar=c(2,0,0,0),oma=c(4,5,2,2))
plot(tje.corr.2006.2012.totals$P.by.cut.date.mm,tje.corr.2006.2012.totals$Tons_removed_uncorrected,xlab="Precipitation between cleanings, mm",ylab="Tons removed",pch=20,cex=1.5,ylim=c(0,90000),xlim=c(0,600))
points(tje.corr.2006.2012.totals$P.by.cut.date.mm,tje.corr.2006.2012.totals$Corrected_load_tons,pch=20,cex=1.5,col="grey")
text()
plot(tje.corr.2006.2012.totals$P.lind.by.cut.date.mm,tje.corr.2006.2012.totals$Tons_removed_uncorrected,xlab="Precipitation between cleanings, mm",ylab="Tons removed",pch=20,cex=1.5,ylim=c(0,90000),xlim=c(0,600))
points(tje.corr.2006.2012.totals$P.lind.by.cut.date.mm,tje.corr.2006.2012.totals$Corrected_load_tons,pch=20,cex=1.5,col="grey")
plot(tje.corr.2006.2012.totals$P.SDBF.by.cut.date.mm,tje.corr.2006.2012.totals$Tons_removed_uncorrected,xlab="Precipitation between cleanings, mm",ylab="Tons removed",pch=20,cex=1.5,ylim=c(0,90000),xlim=c(0,600))
points(tje.corr.2006.2012.totals$P.SDBF.by.cut.date.mm,tje.corr.2006.2012.totals$Corrected_load_tons,pch=20,cex=1.5,col="grey")
tje.corr.2006.2012.totals
